SPRITE_SCHEME = {}
SPRITE_SCHEME["number_0"] = {
	img = "640hud7",
	x = 0,
	y = 0,
	w = 20,
	h = 25
}
SPRITE_SCHEME["number_1"] = {
	img = "640hud7",
	x = 23,
	y = 0,
	w = 20,
	h = 25
}
SPRITE_SCHEME["number_2"] = {
	img = "640hud7",
	x = 47,
	y = 0,
	w = 20,
	h = 25
}
SPRITE_SCHEME["number_3"] = {
	img = "640hud7",
	x = 70,
	y = 0,
	w = 20,
	h = 25
}
SPRITE_SCHEME["number_4"] = {
	img = "640hud7",
	x = 95,
	y = 0,
	w = 20,
	h = 25
}
SPRITE_SCHEME["number_5"] = {
	img = "640hud7",
	x = 119,
	y = 0,
	w = 20,
	h = 25
}
SPRITE_SCHEME["number_6"] = {
	img = "640hud7",
	x = 144,
	y = 0,
	w = 20,
	h = 25
}
SPRITE_SCHEME["number_7"] = {
	img = "640hud7",
	x = 169,
	y = 0,
	w = 20,
	h = 25
}
SPRITE_SCHEME["number_8"] = {
	img = "640hud7",
	x = 192,
	y = 0,
	w = 20,
	h = 25
}
SPRITE_SCHEME["number_9"] = {
	img = "640hud7",
	x = 216,
	y = 0,
	w = 20,
	h = 25
}
SPRITE_SCHEME["cross"] = {
	img = "640hud7",
	x = 48,
	y = 24,
	w = 24,
	h = 24
}
SPRITE_SCHEME["suit_full"] = {
	img = "640hud7",
	x = 0,
	y = 25,
	w = 24,
	h = 23
}
SPRITE_SCHEME["suit_empty"] = {
	img = "640hud7",
	x = 24,
	y = 25,
	w = 24,
	h = 23
}
SPRITE_SCHEME["suithelmet_full"] = {
	img = "640hud7",
	x = 0,
	y = 124,
	w = 24,
	h = 23
}
SPRITE_SCHEME["suithelmet_empty"] = {
	img = "640hud7",
	x = 24,
	y = 124,
	w = 24,
	h = 23
}
SPRITE_SCHEME["dollar"] = {
	img = "640hud7",
	x = 192,
	y = 25,
	w = 18,
	h = 24
}
SPRITE_SCHEME["divider"] = {
	img = "640hud7",
	x = 240,
	y = 0,
	w = 2,
	h = 40
}
SPRITE_SCHEME["stopwatch"] = {
	img = "640hud7",
	x = 144,
	y = 72,
	w = 24,
	h = 24
}
SPRITE_SCHEME["plus"] = {
	img = "640hud7",
	x = 223,
	y = 25,
	w = 17,
	h = 22
}
SPRITE_SCHEME["minus"] = {
	img = "640hud7",
	x = 210,
	y = 25,
	w = 13,
	h = 22
}
SPRITE_SCHEME["556nato"] = {
	img = "640hud7",
	x = 0,
	y = 96,
	w = 24,
	h = 23
}
SPRITE_SCHEME["d_skull"] = {
	img = "640hud1",
	x = 224,
	y = 240,
	w = 32,
	h = 16
}
SPRITE_SCHEME["d_headshot"] = {
	img = "640hud1",
	x = -1,
	y = 241,
	w = 36,
	h = 15
}
SPRITE_SCHEME["d_wep_cs16_ak47"] = {
	img = "640hud1",
	x = 192,
	y = 80,
	w = 48,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_knife"] = {
	img = "640hud1",
	x = 192,
	y = 0,
	w = 48,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_awp"] = {
	img = "640hud1",
	x = 192,
	y = 128,
	w = 48,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_deagle"] = {
	img = "640hud1",
	x = 224,
	y = 16,
	w = 32,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_famas"] = {
	img = "640hud2",
	x = 192,
	y = 144,
	w = 48,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_fiveseven"] = {
	img = "640hud16",
	x = 192,
	y = 0,
	w = 32,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_flashbang"] = {
	img = "640hud1",
	x = 192,
	y = 192,
	w = 48,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_g3sg1"] = {
	img = "640hud1",
	x = 192,
	y = 144,
	w = 48,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_galil"] = {
	img = "640hud2",
	x = 192,
	y = 160,
	w = 48,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_glock18"] = {
	img = "640hud1",
	x = 192,
	y = 16,
	w = 32,
	h = 16
}
SPRITE_SCHEME["d_cs16_hegrenade"] = {
	img = "640hud1",
	x = 224,
	y = 192,
	w = 32,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_hegrenade"] = {
	img = "640hud1",
	x = 224,
	y = 192,
	w = 32,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_m249"] = {
	img = "640hud1",
	x = 192,
	y = 160,
	w = 48,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_m3"] = {
	img = "640hud1",
	x = 192,
	y = 48,
	w = 48,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_m4a1"] = {
	img = "640hud1",
	x = 192,
	y = 96,
	w = 48,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_mp5n"] = {
	img = "640hud1",
	x = 192,
	y = 64,
	w = 32,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_p228"] = {
	img = "640hud1",
	x = 224,
	y = 32,
	w = 32,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_p90"] = {
	img = "640hud1",
	x = 192,
	y = 176,
	w = 48,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_scout"] = {
	img = "640hud1",
	x = 192,
	y = 208,
	w = 48,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_sg550"] = {
	img = "640hud16",
	x = 192,
	y = 48,
	w = 48,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_sg552"] = {
	img = "640hud1",
	x = 192,
	y = 112,
	w = 48,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_ump45"] = {
	img = "640hud16",
	x = 192,
	y = 80,
	w = 48,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_usp"] = {
	img = "640hud1",
	x = 192,
	y = 32,
	w = 32,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_tmp"] = {
	img = "640hud1",
	x = 224,
	y = 64,
	w = 32,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_xm1014"] = {
	img = "640hud1",
	x = 192,
	y = 224,
	w = 48,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_aug"] = {
	img = "640hud1",
	x = 148,
	y = 240,
	w = 44,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_mac10"] = {
	img = "640hud1",
	x = 109,
	y = 240,
	w = 34,
	h = 16
}
SPRITE_SCHEME["d_wep_cs16_elite"] = {
	img = "640hud1",
	x = 52,
	y = 240,
	w = 57,
	h = 16
}
SPRITE_SCHEME["CS16_556NATO"] = {
	img = "640hud7",
	x = 0,
	y = 96,
	w = 24,
	h = 24
}
SPRITE_SCHEME["CS16_556NATOBOX"] = {
	img = "640hud7",
	x = 0,
	y = 96,
	w = 24,
	h = 24
}
SPRITE_SCHEME["CS16_762NATO"] = {
	img = "640hud7",
	x = 72,
	y = 72,
	w = 24,
	h = 24
}
SPRITE_SCHEME["CS16_BUCKSHOT"] = {
	img = "640hud7",
	x = 0,
	y = 72,
	w = 24,
	h = 24
}
SPRITE_SCHEME["CS16_9MM"] = {
	img = "640hud7",
	x = 48,
	y = 72,
	w = 24,
	h = 24
}
SPRITE_SCHEME["CS16_50AE"] = {
	img = "640hud7",
	x = 24,
	y = 72,
	w = 24,
	h = 24
}
SPRITE_SCHEME["CS16_338MAGNUM"] = {
	img = "640hud7",
	x = 24,
	y = 96,
	w = 24,
	h = 24
}
SPRITE_SCHEME["CS16_45ACP"] = {
	img = "640hud7",
	x = 96,
	y = 72,
	w = 24,
	h = 24
}
SPRITE_SCHEME["CS16_357SIG"] = {
	img = "640hud7",
	x = 120,
	y = 72,
	w = 24,
	h = 24
}
SPRITE_SCHEME["CS16_57MM"] = {
	img = "640hud7",
	x = 120,
	y = 96,
	w = 24,
	h = 24
}
SPRITE_SCHEME["CS16_HEGRENADE"] = {
	img = "640hud7",
	x = 72,
	y = 96,
	w = 24,
	h = 24
}
SPRITE_SCHEME["CS16_C4"] = {
	img = "640hud7",
	x = 96,
	y = 96,
	w = 24,
	h = 24
}
SPRITE_SCHEME["buyzone"] = {
	img = "640hud7",
	x = 96,
	y = 149,
	w = 32,
	h = 32
}
SPRITE_SCHEME["c4"] = {
	img = "640hud7",
	x = 0,
	y = 149,
	w = 32,
	h = 32
}
SPRITE_SCHEME["defuser"] = {
	img = "640hud7",
	x = 32,
	y = 149,
	w = 32,
	h = 32
}
function GetSpriteID( id )
	return SPRITE_SCHEME[id]
end
function DrawSpriteElement( id, color, x, y, w, h, offset )
	local offset = offset or 0
	local pngW = 256
	local pngH = 256
	local spriteElement = GetSpriteID( id )
	if !spriteElement then return end
	surface.SetMaterial( Material( spriteElement.img ) )
	surface.SetDrawColor( color )
	surface.DrawTexturedRectUV( x, y, w, h, spriteElement.x / pngW, spriteElement.y / pngH + offset,  spriteElement.w / pngW + spriteElement.x / pngW, spriteElement.h / pngH + spriteElement.y / pngH )
end
function DrawSpriteNumbers( number, x, y, color, noaddi )
	local number_0 = GetSpriteID( "number_0" )
	local charTable = string.ToTable( tostring( number ) )
	local x = x - number_0.w * #charTable
	for k, v in pairs( charTable ) do
		local offset = 0
		if k > 1 then
			offset = (k - 1) * 21
		end
		local sprite = "number_" .. v
		DrawSpriteElement( sprite, color, x + offset, y, 21, 26 )
	end
end
local function ScaleColors( r, g, b, a )
	local x = a / 255
	r = r * x
	g = g * x
	b = b * x
	return r, g, b
end
local function GetPainColor( r, g, b )
	local iHealth = LocalPlayer():Health()

	if iHealth > 25 then
		iHealth = iHealth - 25
	elseif iHealth < 0 then
		iHealth = 0
	end
	if LocalPlayer():Health() > 25 then
		r = 255
		g = 160
		b = 0
	else
		r = 250
		g = 0
		b = 0
	end
	return r, g, b
end
local m_fFade = 0
local m_fFade_Armor = 0
local oldarmor = 0
local additiveRect = CreateMaterial("_additiveRect","UnlitGeneric", {
	["$vertexalpha"] = 1,
	["$vertexcolor"] = 1,
	["$additive"] = 1
})

function DrawHealthAndArmor()
	local LP = LocalPlayer()
	if !LP:Alive() then return end
	if LP:GetState() != STATE_ACTIVE then return end

	local r,g,b,a = 0, 0, 0, 0
	local number_0 = GetSpriteID( "number_0" )
	local cross = GetSpriteID( "cross" )
	local offset = number_0.w * 3

	if m_fFade != 0 then
		m_fFade = m_fFade - FrameTime() * 100
		
		if m_fFade <= 0 then
			m_fFade = 0
		end
		a = 200 + ( m_fFade / 100 ) * 128
	else
		a = 200
	end
	if LP:Health() <= 15 then
		a = 255
	end
	r, g, b = GetPainColor( r, g, b )
	r, g, b, a = ScaleColors( r, g, b, a )

	local x, y = 8, ScrH() - number_0.h - 1 - 16
	draw.RoundedBox( 4, x, y, 6 + cross.w + offset + 6, number_0.h + 1 + 12, Color( 0, 0, 0, 100 ) )
	DrawSpriteElement( "cross", Color( r, g, b, a ), x + 6, y + 6, 24, 24 )
	DrawSpriteNumbers( LP:Health(), x + offset + 6 + 24, y + 6, Color( r, g, b, a ) )

	local r,g,b,a = 0, 0, 0, 0
	r, g, b, a = ScaleColors( r, g, b, a )
	if m_fFade_Armor != 0 then
		m_fFade_Armor = m_fFade_Armor - FrameTime() * 100
		
		if m_fFade_Armor <= 0 then
			m_fFade_Armor = 0
		end
		a = 200 + ( m_fFade_Armor / 100 ) * 128
	else
		a = 200
	end
	r = 255
	g = 160
	b = 0
	r, g, b, a = ScaleColors( r, g, b, a )

	local mat_empty = LP:Getm_bHasHelmet() and "suithelmet_empty" or "suit_empty"
	local mat_full = LP:Getm_bHasHelmet() and "suithelmet_full" or "suit_full"
	local suit = GetSpriteID( "suit_empty" )
	local offset = number_0.w * 3
	local offset_full = 24 * (1 - LP:Getm_iArmorValue() / 100)
	local x, y = ScrW() / 5.25, ScrH() - number_0.h - 1 - 16
	draw.RoundedBox( 4, x, y, 6 + suit.w + offset + 6, number_0.h + 1 + 12, Color( 0, 0, 0, 100 ) )
	DrawSpriteElement( mat_empty, Color( r, g, b, a ), x + 6, y + 6, 24, 24 )
	DrawSpriteElement( mat_full, Color( r, g, b, a ), x + 6, y + 6 + offset_full, 24, 24 - offset_full, offset_full/256 )
	DrawSpriteNumbers( LP:Getm_iArmorValue(), x + offset + 6 + 24, y + 6, Color( r, g, b, a ) )

	if oldarmor != LP:Getm_iArmorValue() then
		hook.Run( "player_change_armor" )
		oldarmor = LP:Getm_iArmorValue()
	end
end

gameevent.Listen("player_hurt")
hook.Add( "player_hurt", "HUDFlash", function( data )
	if data.userid == LocalPlayer():UserID() then
		m_fFade = 50
	end
end )
hook.Add( "player_change_armor", "HUDFlash", function()
	m_fFade_Armor = 50
end )
local roundTimer_Green = 160
local roundTimer_Alpha = 200
local roundTimer_Blink = false
local roundTimer_NextBlink = 0
local roundTimer_NextUnBlink = 0
local function Blink( speed )
	if !roundTimer_Blink and CurTime() < roundTimer_NextUnBlink then
		roundTimer_NextBlink = CurTime() + speed * 2
		roundTimer_Blink = true
	end
	if CurTime() > roundTimer_NextUnBlink and CurTime() < roundTimer_NextBlink then
		roundTimer_Green = 0
		roundTimer_Alpha = 255
	end
	if CurTime() > roundTimer_NextBlink then
		roundTimer_Blink = false
		roundTimer_NextUnBlink = CurTime() + speed
	end
end

function DrawRoundTimer()
	local LP = LocalPlayer()
	if !LP:Alive() then return end
	if LP:GetState() != STATE_ACTIVE then return end
	if GetGlobalBool( "m_bBombPlanted" ) then return end

	local r,g,b,a = 0, 0, 0, 0
	local number_0 = GetSpriteID( "number_0" )
	local stopwatch = GetSpriteID( "stopwatch" )
	local two = number_0.w * 2
	local time = GetRoundRemainingTime()
	if IsFreezePeriod() then
		time = GetRoundRemainingTime() - GetGlobalFloat("m_iRoundTime")
	end
	local minutes = os.date( "%M" , time )
	local seconds = os.date( "%S" , time )
	minutes = minutes and minutes or 0
	seconds = seconds and seconds or "00"
	roundTimer_Alpha = 200
	roundTimer_Green = 160
	if time <= 30.5 and time > 20 then
		Blink( 1 )
	end
	if time <= 20.5 and time > 10 then
		Blink( 0.5 )
	end
	if time <= 10.5 and time > 5 then
		Blink( 0.15 )
	end
	if time <= 5.5 then
		Blink( 0.09 )
	end
	if time > 30 and time <= 30.5 then
		roundTimer_Green = 0
		roundTimer_Alpha = 255
	elseif time > 20 and time <= 20.5 then
		roundTimer_Green = 0
		roundTimer_Alpha = 255
	elseif time > 5 and time <= 5.25 then
		roundTimer_Green = 0
		roundTimer_Alpha = 255
	elseif time < 1 then
		roundTimer_Green = 0
		roundTimer_Alpha = 255
	end

	r = 255
	g = roundTimer_Green
	b = 0
	a = roundTimer_Alpha
	
	r, g, b, roundTimer_Alpha = ScaleColors( r, g, b, a )

	local wide = 6 + stopwatch.w + two * 2 + 6 + 8
	local x, y = ScrW() / 2 - wide / 2, ScrH() - number_0.h - 1 - 16
	draw.RoundedBox( 4, x, y, wide, number_0.h + 1 + 12, Color( 0, 0, 0, 100 ) )
	DrawSpriteElement( "stopwatch", Color( r, g, b, a ), x + 6, y + 6, 24, 24 )
	
	local x = x + two + 6 + 24
	DrawSpriteNumbers( tonumber( minutes ), x, y + 6, Color( r, g, b, a ) )
	local x = x + 2
	local y2 = y + number_0.h / 2 + 2
	surface.SetDrawColor( Color( r, g, b, a ) )
	surface.SetMaterial( additiveRect )
	surface.DrawTexturedRect( x, y2, 2, 2 )
	surface.DrawTexturedRect( x, y2 + 5, 2, 2 )

	DrawSpriteNumbers( seconds, x + two + 4, y + 6, Color( r, g, b, a ) )
end

local money_Red = 255
local money_Green = 160
local money_Alpha = 200
local oldmoney = 0
local money_Bonus_Show = false
local money_Bonus_Value = 0
local money_Bonus_Red = 0
local money_Bonus_Green = 160
local money_Bonus_Fade = 255
function DrawMoney()
	local LP = LocalPlayer()
	if !LP:Alive() then return end
	if LP:GetState() != STATE_ACTIVE then return end

	local r,g,b,a = 0, 0, 0, 0
	local number_0 = GetSpriteID( "number_0" )
	local cross = GetSpriteID( "dollar" )
	local offset = number_0.w * 5

	if m_fFade != 0 then
		m_fFade = m_fFade - FrameTime() * 100
		
		if m_fFade <= 0 then
			m_fFade = 0
		end
		a = 200 + ( m_fFade / 100 ) * 128
	else
		a = 200
	end
	if LP:Health() <= 15 then
		a = 255
	end


	if money_Red != 255 then
		money_Red = Lerp( FrameTime() / 3, money_Red, 255 )
	end
	if money_Green != 160 then
		money_Green = Lerp( FrameTime() / 3, money_Green, 160 )
	end
	if money_Alpha != 200 then
		money_Alpha = Lerp( FrameTime() / 3, money_Alpha, 200 )
	end
	
	r = money_Red
	g = money_Green
	b = 0
	a = money_Alpha
	r, g, b, a = ScaleColors( r, g, b, a )
	local wide = 16 + cross.w + offset + 6
	local x, y = ScrW() - wide - 8, ScrH() - number_0.h * 2 - 1 * 2 - 16 * 2
	draw.RoundedBox( 4, x, y, wide, number_0.h + 1 + 12, Color( 0, 0, 0, 100 ) )
	DrawSpriteElement( "dollar", Color( r, g, b, a ), x + 6, y + 6, 24, 24 )
	DrawSpriteNumbers( LP:GetMoney(), x + offset + 6 + 24, y + 6, Color( r, g, b, a ) )

	if oldmoney != LP:GetMoney() then

		money_Alpha = 255
		if LP:GetMoney() > oldmoney then
			money_Red = 0
			money_Green = 160
		else
			money_Red = 255
			money_Green = 0
		end
		oldmoney = LP:GetMoney()
	end

	if money_Bonus_Show and money_Bonus_Fade > 0 then
		local mat_sign = money_Bonus_Value > 0 and "plus" or "minus"
		r = money_Bonus_Value < 0 and 255 or 0
		g = money_Bonus_Value > 0 and 255 or 0
		b = 0
		money_Bonus_Fade = Lerp( FrameTime() / 2, money_Bonus_Fade, 0 )
		a = money_Bonus_Fade
		local sign = GetSpriteID( mat_sign )
		local wide = 16 + sign.w + offset + 6
		local x, y = ScrW() - wide - 8, ScrH() - number_0.h * 3 - 1 * 3 - 16 * 3
		DrawSpriteElement( mat_sign, Color( r, g, b, a ), x + 6 + 2, y + 6 + 2, 17, 23 )
		DrawSpriteNumbers( math.abs( money_Bonus_Value ), x + offset + 6 + 24, y + 6, Color( r, g, b, a ) )
	else
		money_Bonus_Show = false
	end
end

hook.Add( "player_money_changed", "MoneyNotify", function( value )
	money_Bonus_Value = value
	money_Bonus_Fade = 255
	money_Bonus_Show = true
end )

local m_fFade_Ammo = 55
local oldClip1 = 0
local oldAmmo1 = 0
function DrawAmmo()
	local LP = LocalPlayer()
	if !LP:Alive() then return end
	if LP:GetState() != STATE_ACTIVE then return end
	if !LP:GetActiveWeapon() then return end
	if !LP:GetActiveWeapon().Primary then return end
	if LP:GetActiveWeapon().Primary.Ammo == "none" then return end

	local mat_ammo = LP:GetActiveWeapon().Primary.Ammo and LP:GetActiveWeapon().Primary.Ammo or "556nato"
	local clip1 = LP:GetActiveWeapon():Clip1()
	local ammo1 = LP:GetAmmoCount( LP:GetActiveWeapon():GetPrimaryAmmoType())
	local clip1_size = string.ToTable( clip1 )
	local ammo1_size = string.ToTable( ammo1 )
	local r,g,b,a = 0, 0, 0, 0
	local number_0 = GetSpriteID( "number_0" )
	local ammo = GetSpriteID( mat_ammo )
	local offset = number_0.w * #clip1_size
	if clip1 < 0 then
		offset = 0
	end
	local offset2 = number_0.w * #ammo1_size
	r, g, b, a = ScaleColors( r, g, b, a )
	if m_fFade_Ammo != 0 then
		m_fFade_Ammo = m_fFade_Ammo - FrameTime() * 100
		
		if m_fFade_Ammo <= 0 then
			m_fFade_Ammo = 0
		end
		a = 200 + ( m_fFade_Ammo / 100 ) * 128
	else
		a = 200
	end
	r = 255
	g = 160
	b = 0
	r, g, b, a = ScaleColors( r, g, b, a )

	local mul = 1
	if clip1 < 0 then
		mul = 0
	end
	local wide = 16 + offset + 12 + offset2 + number_0.w * mul + ammo.w
	local x, y = ScrW() - wide - 8, ScrH() - number_0.h - 1 - 16
	draw.RoundedBox( 4, x, y, wide, number_0.h + 1 + 12, Color( 0, 0, 0, 100 ) )
	if clip1 >= 0 then
		DrawSpriteElement( "divider", Color( r, g, b, a ), x + offset + 6 + 8, y + 6, 2, 25 )
		DrawSpriteNumbers( clip1, x + offset + 6, y + 6, Color( r, g, b, a ) )
	end
	local x = x + offset2 + number_0.w * mul + offset + 16
	DrawSpriteNumbers( ammo1, x, y + 6, Color( r, g, b, a ) )
	DrawSpriteElement( mat_ammo, Color( r, g, b, a ), x + 4, y + 6, 24, 24 )

	if oldClip1 != clip1 or oldAmmo1 != ammo1 then
		hook.Run( "player_ammo_changed" )
		oldClip1 = clip1
		oldAmmo1 = ammo1
	end
end

hook.Add( "player_ammo_changed", "MoneyNotify", function( value )
	m_fFade_Ammo = 55
end )

local function DrawDeathnoticeText( x, y, color1, attacker, weaponIcon, color2, victim, isHeadshot )
	surface.SetFont("CSDeathnotice")
	local base_w, base_h = surface.GetTextSize( "B" )
	local attacker_w, attacker_h = attacker and surface.GetTextSize( attacker ) or 0, 0
	local victim_w, victim_h = victim and surface.GetTextSize( victim ) or 0, 0
	local weaponicon = GetSpriteID( weaponIcon ) and GetSpriteID( weaponIcon ) or GetSpriteID( "d_skull" )
	local headshot = GetSpriteID( "d_headshot" )
	
	local wide = 0
	if attacker then
		wide = wide + attacker_w + 5
	end
	wide = wide + weaponicon.w + 5
	if isHeadshot then
		wide = wide + headshot.w + 5
	end
	if victim then
		wide = wide + victim_w + 5
	end
	wide = wide + 12
	x = x - wide
	draw.RoundedBox( 4, x, y, wide, base_h + 12, Color( 0, 0, 0, 100 ) )
	x = x + 6
	y = y + 4
	if attacker then
		surface.SetTextPos( x + 1, y + 1)
		surface.SetTextColor( 0, 0, 0 )
		surface.DrawText( attacker )

		surface.SetTextPos( x, y )
		surface.SetTextColor( color1 )
		surface.DrawText( attacker )
	end
	x = x + attacker_w + 5
	DrawSpriteElement( weaponIcon, Color( 255, 160, 0, 255 ), x, y, weaponicon.w, weaponicon.h )
	if isHeadshot then
		x = x + weaponicon.w + 5
		DrawSpriteElement( "d_headshot", Color( 255, 160, 0, 255 ), x, y, 36, 16 )
		x = x + headshot.w + 5
	else
		x = x + weaponicon.w + 5
	end
	if victim then
		surface.SetTextPos( x + 1, y + 1)
		surface.SetTextColor( 0, 0, 0 )
		surface.DrawText( victim )

		surface.SetTextPos( x, y )
		surface.SetTextColor( color2 )
		surface.DrawText( victim )
	end
end

local Deathnotice_history = {}
function DrawDeathnotice()
	local LP = LocalPlayer()
	local number_0 = GetSpriteID( "number_0" )

	surface.SetFont("CSDeathnotice")
	if IsValid( LP:GetEyeTrace().Entity ) then
		if LP:GetEyeTrace().Entity:IsPlayer() then
			local prefix = "Friendly : "
			if LP:GetEyeTrace().Entity:Team() == LP:Team() then
				prefix = "Enemy : "
			end
			surface.SetTextPos( 8 + 1, ScrH() - number_0.h * 2 - 16 + 1)
			surface.SetTextColor( 0, 0, 0 )
			surface.DrawText( prefix..LP:GetEyeTrace().Entity:Nick().." ("..LP:GetEyeTrace().Entity:Health()..")" )
		
			surface.SetTextPos( 8, ScrH() - number_0.h * 2 - 16 )
			surface.SetTextColor( team.GetColor( LP:GetEyeTrace().Entity:Team() ) )
			surface.DrawText( prefix..LP:GetEyeTrace().Entity:Nick().." ("..LP:GetEyeTrace().Entity:Health()..")" )
		end
	end

	local base_w, base_h = surface.GetTextSize( "B" )
	local base_x = ScrW() - ScreenScaleZ( 16 )
	local base_y = ScreenScaleZ( 32 )
	if LP:IsObserver() then
		base_y = ScreenScaleZ( 64 ) + 10
	end
	for k,v in pairs( Deathnotice_history ) do
		local i = k
		i = i - 1
		if v.timer >= CurTime() then
			DrawDeathnoticeText( base_x, base_y + (base_h + 12) * i, v.color1, v.name1, v.weaponicon, v.color2, v.name2, v.headshot )
		else
			table.remove( Deathnotice_history, k )
		end
	end
end
function umsg_Deathnotice( data )
	local pAttacker = data:ReadString()
	local pVictim = data:ReadString()
	local pInflictor = data:ReadString()
	local iTeam1 = data:ReadShort()
	local iTeam2 = data:ReadShort()
	local headshot = data:ReadBool()
	local weaponIcon = "d_" .. pInflictor
	if !SPRITE_SCHEME[weaponIcon] then
		weaponIcon = "d_skull"
	end
	if pAttacker == pVictim then
		pAttacker = nil
	end
	table.insert( Deathnotice_history, {
		color1 = team.GetColor( iTeam1 ),
		name1 = pAttacker,
		name2 = pVictim,
		weaponicon = weaponIcon,
		color2 = team.GetColor( iTeam2 ),
		headshot = headshot,
		timer = CurTime() + 6
	} )
end
usermessage.Hook( "PlayerKilled", umsg_Deathnotice )

local m_flAttackFront = 0
local m_flAttackRear = 0
local m_flAttackLeft = 0
local m_flAttackRight = 0
local icon_up = Material( "640_pain_up" )
local icon_down = Material( "640_pain_down" )
local icon_left = Material( "640_pain_left" )
local icon_right = Material( "640_pain_right" )
local m_flFadeCompleteTime = 0
local m_clrIndicator = Color( 250, 0, 0, m_fFade )

local function ShouldDraw()
	if m_flAttackFront <= 0 and m_flAttackRear <= 0 and m_flAttackLeft <= 0 and m_flAttackRight <= 0 then
		return false
	end
	
	return true
end
local function DrawDamageIndicatorFront( flFade )
	local r, g, b, a, shade = 255, 0, 0, 255, 0
	a = math.max( a - ( flFade * 50 ), 0 )

	if m_flAttackFront > 0.4 then
		local x = ( ScrW() / 2 ) - (128 - 8) / 2;
		local y = ( ScrH() / 2 ) - 64 * 3;
		surface.SetDrawColor( Color( r, g, b, a ) )
		surface.SetMaterial( icon_up )
		surface.DrawTexturedRect( x, y + 32, 128, 64 )

		m_flAttackFront = math.max( 0.0, m_flAttackFront - flFade );
	else
		m_flAttackFront = 0.0
	end
end
local function DrawDamageIndicatorRear( flFade )
	local r, g, b, a, shade = 255, 0, 0, 255, 0
	a = math.max( a - ( flFade * 50 ), 0 )

	if m_flAttackRear > 0.4 then
		local x = ( ScrW() / 2 ) - (128 - 8) / 2
		local y = ( ScrH() / 2 ) + 64 * 2;
		surface.SetDrawColor( Color( r, g, b, a ) )
		surface.SetMaterial( icon_down )
		surface.DrawTexturedRect( x, y - 32 + 24, 128, 64 )

		m_flAttackRear = math.max( 0.0, m_flAttackRear - flFade );
	else
		m_flAttackRear = 0.0
	end
end
local function DrawDamageIndicatorLeft( flFade )
	local r, g, b, a, shade = 255, 0, 0, 255, 0
	a = math.max( a - ( flFade * 50 ), 0 )

	if m_flAttackLeft > 0.4 then
		local x = ( ScrW() / 2 ) - 64 * 3;
		local y = ( ScrH() / 2 ) - (128 - 8) / 2;
		surface.SetDrawColor( Color( r, g, b, a ) )
		surface.SetMaterial( icon_left )
		surface.DrawTexturedRect( x + 32, y, 64, 128 )

		m_flAttackLeft = math.max( 0.0, m_flAttackLeft - flFade );
	else
		m_flAttackLeft = 0.0
	end
end
local function DrawDamageIndicatorRight( flFade )
	local r, g, b, a, shade = 255, 0, 0, 255, 0
	a = math.max( a - ( flFade * 50 ), 0 )

	if m_flAttackRight > 0.4 then
		local x = ( ScrW() / 2 ) + 64 * 2 + 24
		local y = ( ScrH() / 2 ) - (128 - 8) / 2
		surface.SetDrawColor( Color( r, g, b, a ) )
		surface.SetMaterial( icon_right )
		surface.DrawTexturedRect( x - 32, y, 64, 128 )

		m_flAttackRight = math.max( 0.0, m_flAttackRight - flFade );
	else
		m_flAttackRight = 0.0
	end
end
function CalcDamageDirection( vecFrom )
	if vecFrom == vec3_origin then
		m_flAttackFront	= 0.0
		m_flAttackRear	= 0.0
		m_flAttackRight	= 0.0
		m_flAttackLeft	= 0.0

		return
	end

	if !LocalPlayer() then
		return
	end

	local vecDelta = ( vecFrom - LocalPlayer():GetPos() )

	if vecDelta:Length() <= 50 then
		m_flAttackFront	= 1.0
		m_flAttackRear	= 1.0
		m_flAttackRight	= 1.0
		m_flAttackLeft	= 1.0

		return
	end

	vecDelta:Normalize()

	local forward = LocalPlayer():GetAngles():Forward()
	local right = LocalPlayer():GetAngles():Right()

	local flFront	= vecDelta:DotProduct( forward )
	local flSide	= vecDelta:DotProduct( right )

	if flFront > 0 then
		if flFront > 0.3 then
			m_flAttackFront = math.max( m_flAttackFront, flFront )
		end
	else
		local f = math.abs( flFront )
		if f > 0.3 then
			m_flAttackRear = math.max( m_flAttackRear, f )
		end
	end

	if flSide > 0 then
		if flSide > 0.3 then
			m_flAttackRight = math.max( m_flAttackRight, flSide )
		end
	else
		local f = math.abs( flSide )
		if f > 0.3 then
			m_flAttackLeft = math.max( m_flAttackLeft, f )
		end
	end
end
function DrawDamageIndicator()
	if !ShouldDraw() then return end

	if m_flFadeCompleteTime > CurTime() then
		local flFade = FrameTime() * 2;

		DrawDamageIndicatorFront( flFade );
		DrawDamageIndicatorRear( flFade );
		DrawDamageIndicatorLeft( flFade );
		DrawDamageIndicatorRight( flFade );
	end	
end
function umsg_msg_Damage( data )
	local vector = data:ReadVector()
	m_flFadeCompleteTime = CurTime() + 1.0
	CalcDamageDirection( vector )
end
usermessage.Hook( "msg_Damage", umsg_msg_Damage )

local white_additive = CreateMaterial( "_AdditiveRect", "UnlitGeneric", {
	["$basetexture"] = "white",
    ["$vertexcolor"] = 1,
    ["$vertexalpha"] = 1,
    ["$additive"] = 1,
} )
function DrawProgressBar()
	local LP = LocalPlayer()

	local observer = LocalPlayer():GetObserverTarget()
	if IsValid( observer ) and observer:IsPlayer() then
		LP = observer
	end

	if !LP then return end
	if !LP:Alive() then return end
	if (!LP.Getm_progressEnd or !LP.Getm_progressStart) or LP:Getm_progressEnd() <= 0 then return end

	local x, y, wide, tall = 0, 0, ScreenScaleZ( 320 ), 10
	x = ScrW() / 2 - wide / 2
	y = ScrH() / 2 + 64
	local xOffset = 0
	local yOffset = 0

	surface.SetDrawColor( 255, 160, 0, 255 )
	surface.SetMaterial( white_additive )
	surface.DrawTexturedRect( x + xOffset, y + yOffset, xOffset + wide, 1)
	surface.DrawTexturedRect( x + xOffset, y + yOffset + 9, xOffset + wide, 1)
	surface.DrawTexturedRect( x + xOffset, y + yOffset + 1, 1, 8)
	surface.DrawTexturedRect( x + xOffset + wide - 1, y + yOffset + 1, 1, 8)

	local percent = (CurTime() - LP:Getm_progressStart()) / LP:Getm_progressEnd()
	percent = math.Clamp( percent, 0, 1 )
	
	surface.DrawTexturedRect( x + xOffset + 2, y + yOffset + 2, xOffset + ( percent * wide ) - 4, yOffset + 10 - 4)
end

local m_flNextFlashTime = 0
local m_bFlash = false
function DrawStatusIndicator()
	if LocalPlayer():HasDefuser() then
		DrawSpriteElement( "defuser", Color( 0, 255, 0, 255 ), 16, ScrH() / 2 - 64 - 8, 32, 32, 0 )
	end
	if LocalPlayer():IsInBuyZone() then
		DrawSpriteElement( "buyzone", Color( 0, 255, 0, 255 ), 16, ScrH() / 2 - 32, 32, 32, 0 )
	end
	if LocalPlayer():HasWeapon( CS16_WEAPON_C4 ) then
		local color = Color( 0, 0, 0, 255 )
		if LocalPlayer():GetInBombSite() then
			if m_flNextFlashTime < CurTime() then
				m_bFlash = !m_bFlash
				m_flNextFlashTime = CurTime() + 0.15
			end
		else
			m_bFlash = false
		end
		if m_bFlash then
			color = Color( 255, 0, 0, 255 )
		else
			color = Color( 0, 255, 0, 255 )
		end
		DrawSpriteElement( "c4", color, 16, ScrH() / 2 + 8, 32, 32, 0 )
	end
end
function GM:HUDShouldDraw( name )	
	if name == "CHudHealth" then
		return false
	elseif name == "CHudBattery" then
		return false
	elseif name == "CHudAmmo" then
		return false
	elseif name == "CHudDamageIndicator" then
		return false
	end
	return true
end